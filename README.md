# Расчёт трудоёмкости разработки ПС

Кроссплатформенное десктопное приложение для расчёта трудоёмкости разработки программных средств по методике СПбГУТ им. проф. М.А. Бонч-Бруевича.

## Содержание

- [Возможности](#возможности)
- [Системные требования](#системные-требования)
- [Установка](#установка)
- [Запуск](#запуск)
- [Тестирование](#тестирование)
- [Сборка исполняемого файла](#сборка-исполняемого-файла)
- [Структура проекта](#структура-проекта)
- [Использование](#использование)
- [Методика расчёта](#методика-расчёта)
- [Лицензия](#лицензия)

---

## Возможности

- **Ввод структуры ПС** — компоненты и функции в иерархическом виде
- **Каталог функций** — выбор из справочника по методике (Приложение 1)
- **Настройка коэффициентов** — все коэффициенты Приложений 2–4
- **Расчёт трудоёмкости** — автоматический расчёт по формулам методики
- **Визуализация** — диаграммы по подпроцессам и компонентам
- **Экспорт** — сохранение в Word (.docx) и Excel (.xlsx)
- **Проекты** — сохранение и загрузка JSON-файлов проектов

---

## Системные требования

- **Python:** 3.10 или выше (рекомендуется 3.12+)
- **ОС:** Windows 10/11, macOS 10.15+, Linux (с поддержкой X11/Wayland)
- **ОЗУ:** не менее 512 МБ
- **Диск:** ~500 МБ для venv и зависимостей (PySide6 ~400 МБ)

### Зависимости Python

| Пакет      | Назначение                          |
|------------|-------------------------------------|
| PySide6    | GUI (Qt6)                           |
| openpyxl   | Экспорт в Excel                     |
| python-docx| Экспорт в Word                      |
| matplotlib | Диаграммы в GUI                     |
| pyinstaller| Сборка исполняемого файла (опц.)    |

---

## Установка

### 1. Клонирование или копирование проекта

```bash
cd labor_estimation
```

### 2. Создание виртуального окружения

Рекомендуется использовать виртуальное окружение (PEP 668):

```bash
python3 -m venv venv
source venv/bin/activate      # Linux/macOS
# или
venv\Scripts\activate        # Windows
```

### 3. Установка зависимостей

```bash
pip install -r requirements.txt
```

Установка может занять несколько минут из‑за размера PySide6 (~400 МБ).

### 4. Проверка установки

```bash
python -c "import PySide6; print('PySide6 OK')"
```

---

## Запуск

```bash
# Активируйте venv (если ещё не активировано)
source venv/bin/activate   # Linux/macOS
venv\Scripts\activate     # Windows

# Запуск приложения
python main.py
```

Приложение откроет главное окно с вкладками.

---

## Тестирование

В проекте есть тесты модели расчёта и сохранения/загрузки проектов.

### Запуск всех тестов

```bash
python tests/test_calculation.py
```

### Запуск через pytest (если установлен)

```bash
pip install pytest   # опционально
pytest tests/ -v
```

### Что проверяют тесты

1. **test_example_calculation** — эталонный пример из методики:
   - структура проекта (5 компонентов, 8 функций);
   - корректность формул T_baz, подпроцессов, итогов;
   - диапазоны объёма и трудоёмкости.

2. **test_save_load_project** — сохранение и загрузка проекта в JSON.

Ожидаемый вывод: `ВСЕ ТЕСТЫ ПРОЙДЕНЫ УСПЕШНО!`

---

## Сборка исполняемого файла

Для создания standalone-приложения используется PyInstaller и spec-файл `labor_estimation.spec`.

### macOS

```bash
cd build_scripts
chmod +x build_macos.sh
./build_macos.sh
```

Результат: `dist/LabLaborEstimation.app`

### Linux

```bash
cd build_scripts
chmod +x build_linux.sh
./build_linux.sh
```

Результат: `dist/LabLaborEstimation`

### Windows

```cmd
cd build_scripts
build_windows.bat
```

Результат: `dist\LabLaborEstimation.exe`

### Сборка вручную

```bash
# Активация venv
source venv/bin/activate

# Сборка
pyinstaller labor_estimation.spec
```

Артефакты сборки:
- `dist/` — готовое приложение
- `build/` — промежуточные файлы (можно удалить)

### Режимы сборки

| Платформа | Режим  | Результат                         |
|-----------|--------|-----------------------------------|
| macOS     | onedir | Папка .app (рекомендуется PyInstaller) |
| Windows   | onefile| Один .exe файл                    |
| Linux     | onefile| Один исполняемый файл             |

---

## Структура проекта

```
labor_estimation/
├── main.py                      # Точка входа
├── labor_estimation.spec        # Конфигурация PyInstaller
├── requirements.txt             # Зависимости Python
├── .gitignore
├── README.md
│
├── app/
│   ├── __init__.py
│   ├── main_window.py           # Главное окно, меню, вкладки
│   │
│   ├── models/                  # Бизнес-логика
│   │   ├── project.py           # Модель проекта, компоненты, функции
│   │   ├── function_catalog.py  # Каталог функций (Приложение 1)
│   │   ├── coefficients.py      # Таблицы коэффициентов (Прил. 2–4)
│   │   └── calculation.py       # Движок расчёта трудоёмкости
│   │
│   ├── widgets/                 # UI-виджеты
│   │   ├── project_info.py      # Общие сведения о проекте
│   │   ├── components_editor.py # Редактор компонентов и функций
│   │   ├── function_selector.py # Диалог выбора функции из каталога
│   │   ├── coefficients_panel.py# Панель коэффициентов
│   │   ├── results_view.py      # Результаты расчёта
│   │   └── chart_widget.py      # Диаграммы
│   │
│   ├── export/                  # Экспорт
│   │   ├── docx_export.py       # Экспорт в Word
│   │   └── xlsx_export.py       # Экспорт в Excel
│   │
│   └── resources/
│       └── style.qss            # Стили Qt (опционально)
│
├── tests/
│   └── test_calculation.py     # Тесты расчёта и проекта
│
└── build_scripts/               # Скрипты сборки
    ├── build_macos.sh
    ├── build_linux.sh
    └── build_windows.bat
```

---

## Использование

### Общий порядок работы

1. **Общие сведения** — название ПС, описание, параметры расчёта (срок, численность).
2. **Каталог функций** — создайте компоненты, добавьте функции из каталога.
3. **Коэффициенты** — выберите значения коэффициентов (Приложения 2–4).
4. **Результаты** — нажмите «Рассчитать» для расчёта трудоёмкости.
5. **Экспорт** — сохраните результаты в Word или Excel.

### Эталонный пример

Для проверки расчётов: **Файл → Загрузить пример из методики**

Загружается эталонный проект из методики (5 компонентов, 8 функций).

### Горячие клавиши

| Действие       | Горячая клавиша |
|----------------|-----------------|
| Новый проект   | Ctrl+N          |
| Открыть        | Ctrl+O          |
| Сохранить      | Ctrl+S          |
| Рассчитать     | Ctrl+R          |

### Формат проекта

Проекты сохраняются в JSON. Содержат:
- метаданные (название, описание);
- компоненты и функции;
- коэффициенты;
- параметры расчёта.

---

## Методика расчёта

Расчёт выполняется по методике СПбГУТ им. проф. М.А. Бонч-Бруевича.

### Скорректированный объём функции

```
Vm_i = Vi × ri × ki
Vk_i = Vm_i × K_slozhn × K_sr_razr × K_opyt
V = Σ Vk_j
```

- `Vi` — базовый объём функции (строки кода)
- `ri` — количество использований
- `ki` — коэффициент повторного использования

### Базовая трудоёмкость

```
T_baz = A × V^C × K_n × K_nad × K_proizv × K_dokum × K_teh × K_or
```

где A = 0.19, C = 0.74

### Трудоёмкости подпроцессов

| Подпроцесс       | Формула                                            |
|------------------|----------------------------------------------------|
| Анализ           | T_baz × 0.01 × K_kval_an × K_opyt_an               |
| Проектирование   | T_baz × 0.12 × K_kval_pr × K_opyt_pr × K_sr_pr     |
| Программирование | T_baz × 0.79 × K_kval_prog × K_sr                  |
| Тестирование     | T_baz × 0.07 × K_kval_test × K_sr_ts × K_BD        |
| Ввод в действие  | T_baz × 0.01 × K_kval_vn                           |

### Итоговая трудоёмкость

```
T_razr = T1 + T2 + T3 + T4 + T5
T_srok = T_razr × K_sr_srok
```

---

## Публикация на GitHub

Локальный git-репозиторий уже создан (ветка `main`). Инструкция по созданию репозитория на GitHub и первому push — в файле [GITHUB_SETUP.md](GITHUB_SETUP.md).

## Лицензия

Разработано для учебного использования на кафедре Информационных управляющих систем СПбГУТ.
